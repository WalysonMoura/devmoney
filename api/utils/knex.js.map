{"version":3,"sources":["../../src/utils/knex.ts","../../src/env/index.ts","../../src/database.ts"],"sourcesContent":["import { Knex, knex as setupKnex } from \"knex\";\nimport { config } from \"../database\";\n\nexport const knex = setupKnex(config);\n","import { config } from \"dotenv\";\nimport { z } from \"zod\";\n\nif (process.env.NODE_ENV === \"test\") {\n  config({ path: \".env.test\" });\n} else {\n  config();\n}\n\nconst envSchema = z.object({\n  NODE_ENV: z.enum([\"development\", \"test\", \"production\"]).default(\"production\"),\n  DATABASE_CLIENT: z.enum([\"sqlite3\", \"pg\"]).default(\"sqlite3\"),\n  DATABASE_URL: z.string(),\n  PORT: z.coerce.number().default(3000),\n});\n\nconst _env = envSchema.safeParse(process.env);\n\nif (_env.success === false) {\n  console.error(\"⚠️ Invalid environment variables\", _env.error.format());\n\n  throw new Error(\"Invalid environment variables.\");\n}\n\nexport const env = _env.data;\n","import { Knex} from \"knex\";\n\nimport { env } from \"./env\";\n\nexport const config: Knex.Config = {\n  client: env.DATABASE_CLIENT,\n  connection:\n    env.DATABASE_CLIENT === 'sqlite3'\n      ? {\n          filename: env.DATABASE_URL,\n        }\n      : env.DATABASE_URL,\n  useNullAsDefault: true,\n  migrations: {\n    extension: 'ts',\n    directory: './db/migrations',\n  },\n}\n\n/* export const configd: { [key: string]: Knex.Config } = {\n  development: {\n    client: 'sqlite3',\n    connection: {\n      filename: env.DATABASE_URL,\n    },\n    useNullAsDefault: true,\n    migrations: {\n      extension: \"ts\",\n      directory: \"./db/migrations\",\n    },\n  },\n\n  staging: {\n    client: \"postgresql\",\n    connection: {\n      database: \"my_db\",\n      user: \"username\",\n      password: \"password\",\n    },\n    pool: {\n      min: 2,\n      max: 10,\n    },\n    migrations: {\n      tableName: \"knex_migrations\",\n    },\n  },\n\n  production: {\n    client: \"postgresql\",\n    connection: {\n      database: \"my_db\",\n      user: \"username\",\n      password: \"password\",\n    },\n    pool: {\n      min: 2,\n      max: 10,\n    },\n    migrations: {\n      tableName: \"knex_migrations\",\n    },\n  },\n};\n */\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAwC;;;ACAxC,oBAAuB;AACvB,iBAAkB;AAElB,IAAI,QAAQ,IAAI,aAAa,QAAQ;AACnC,4BAAO,EAAE,MAAM,YAAY,CAAC;AAC9B,OAAO;AACL,4BAAO;AACT;AAEA,IAAM,YAAY,aAAE,OAAO;AAAA,EACzB,UAAU,aAAE,KAAK,CAAC,eAAe,QAAQ,YAAY,CAAC,EAAE,QAAQ,YAAY;AAAA,EAC5E,iBAAiB,aAAE,KAAK,CAAC,WAAW,IAAI,CAAC,EAAE,QAAQ,SAAS;AAAA,EAC5D,cAAc,aAAE,OAAO;AAAA,EACvB,MAAM,aAAE,OAAO,OAAO,EAAE,QAAQ,GAAI;AACtC,CAAC;AAED,IAAM,OAAO,UAAU,UAAU,QAAQ,GAAG;AAE5C,IAAI,KAAK,YAAY,OAAO;AAC1B,UAAQ,MAAM,8CAAoC,KAAK,MAAM,OAAO,CAAC;AAErE,QAAM,IAAI,MAAM,gCAAgC;AAClD;AAEO,IAAM,MAAM,KAAK;;;ACpBjB,IAAMA,UAAsB;AAAA,EACjC,QAAQ,IAAI;AAAA,EACZ,YACE,IAAI,oBAAoB,YACpB;AAAA,IACE,UAAU,IAAI;AAAA,EAChB,IACA,IAAI;AAAA,EACV,kBAAkB;AAAA,EAClB,YAAY;AAAA,IACV,WAAW;AAAA,IACX,WAAW;AAAA,EACb;AACF;;;AFdO,IAAM,WAAO,YAAAC,MAAUC,OAAM;","names":["config","setupKnex","config"]}